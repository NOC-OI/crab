{% extends 'base.html' %}

{% block title %}Project{% endblock %}

{% block content %}
<div class="container my-5">
<div class="gx-3 row">
    <div class="col-12 col-lg-8 mb-3">
        <div class="p-4 border rounded">
            <h1>{{ project_data.identifier if project_data.identifier is defined else "Untitled project" }}</h1>
            <span>{{ project_data.description }}</span>
            {{ project_readme|safe }}
        </div>

        <div class="accordion" id="accordion-deposits">
            {% for deposit in deposits %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-{{ deposit._id }}">
                <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ deposit._id }}" aria-expanded="true" aria-controls="collapse-{{ deposit._id }}">
                    {{ deposit.identifier | capitalize }} deposit {{ "{" ~ deposit._id ~ "}" }}
                </button>
                </h2>
                <div id="collapse-{{ deposit._id }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" aria-labelledby="heading-{{ deposit._id }}" data-bs-parent="#accordion-deposits">
                <div class="accordion-body">
                    {% if can_edit %}

                    <hr class="my-3">
                    {% endif %}
                    <h5>Snapshots</h5>
                    {% if can_edit %}
                    <a href="/deposits/{{ deposit._id }}/new-snapshot" class="btn btn-primary">Publish snapshot</a>
                    {% endif %}
                    {% for snapshot in deposit.snapshots|reverse %}
                    <div class="mt-3">
                        <div class="card">
                            <div class="card-body">
                                <a href="/snapshots/{{ snapshot._id }}"><h5 class="card-title">{{ snapshot.identifier }}</h5></a>
                                <p class="card-text"><small class="text-muted">{{ "{" ~ snapshot._id ~ "}" }}</small></p>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="mt-3">
                        <p>No data yet!</p>
                    </div>
                    {% endfor %}
                    <hr class="my-3">
                    <h5>Observations</h5>
                    {% if can_edit %}
                    <a href="/runs?connect_to={{ deposit._id }}&connect_type=deposit&finish_redirect=%2Fprojects%2F{{ project_data._id }}" class="btn btn-primary">Add data run</a>
                    {% endif %}
                    {% for run in deposit.runs|reverse %}
                    <div class="mt-3">
                        <div class="card">
                            <div class="card-body">
                                {% if run.identifier %}
                                <a href="/runs/{{ run._id }}"><h5 class="card-title">{{ run.identifier }}</h5></a>
                                <p class="card-text"><small class="text-muted">{{ "{" ~ run._id ~ "}" }}</small></p>
                                {% else %}
                                <a href="/runs/{{ run._id }}"><h5 class="card-title">{{ "{" ~ run._id ~ "}" }}</h5></a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="mt-3">
                        <p>No data yet!</p>
                    </div>
                    {% endfor %}
                </div>
                </div>
            </div>
            {% endfor %}
        </div>



    </div>


    <div class="col-12 col-lg-4">


        <div class="p-4 border rounded">
            <h2>Project actions</h2>

            <a href="/projects/{{ project_data._id }}/export" class="btn btn-primary">Export project</a>
            <a href="/workspaces/new?hints=ANNOTATION_DATA&project_connect_id={{ project_data._id }}" class="btn btn-primary">Upload data or annotations</a>
            <a href="/deposits?project_connect_id={{ project_data._id }}" class="btn btn-primary">Attach data or annotations</a>
            {% if can_edit %}
            <a href="/projects/{{ project_data._id }}/edit" class="btn btn-primary">Edit project information <i class="bi bi-pencil-fill"></i></a>
            {% endif %}
        </div>
        <!--

        btn-outline-secondary
        <form method="POST" action="/api/v1/projects/{{ project_data._id }}/new_deposit?redirect=%2Fprojects%2F{{ project_data._id }}" enctype="multipart/form-data">
            <fieldset>
                <div class="input-group mb-3">
                    <input type="text" name="name" class="form-control" placeholder="Layer name" aria-label="New deposit name" aria-describedby="button-addon2">

                    <input class="btn btn-primary" type="submit" id="button-addon2" value="Create new deposit">

                </div>
            </fieldset>
        </form>
        -->




    </div>

</div>
</div>
{% endblock %}
